#!/bin/bash

cache_dir="$HOME/.jumpo-cache"
cache="$cache_dir/aliases"

if [ ! -d "$cache_dir" ]; then
	mkdir "$cache_dir"
fi
touch "$cache"

function usage() {
	echo "usage: jumpo <command> [alias] [path] [editor]"
	echo ""
	echo "Commands:"
	echo "    add     add an alias"
	echo "    rm      remove alias"
}

if [ "$1" = "add" ]; then
	if [ $# -gt 2 ]; then
		real_path=$(realpath "$3")
		if [ $# -gt 3 ]; then
			if [ -z "$(grep "$4" < "$cache")" ]; then
				echo "$4   $real_path   $2" >> "$cache"
			else
				echo "error: Alias already exists."
			fi
		else
			alias_name=$(echo "$real_path" | awk -F "/" '{print $NF}')
			if [ -z "$(grep "$alias_name" < "$cache")" ]; then
				echo "$alias_name   $real_path   $2" >> "$cache"
			else
				echo "error: Alias already exists."
			fi
		fi
	else
		usage
	fi
elif [ "$1" = "rm" ]; then
	echo "rm $2"
	sed -i "/^$2/d" "$cache"
elif [ "$1" = "show" ]; then
	if [ $# -gt 1 ]; then
		name="$2"
		awk -v alias="$name" '$1 == alias {print $0}' "$cache"
	else
		cat "$cache"
	fi
elif [ $# -lt 1 ] || [ "$1" == "--help" ]; then
	usage
else
	alias=$1
	if [ ! -z "$(grep "$alias" < "$cache")" ]; then
		path=$(grep "$alias" < "$cache" | head -n 1 | awk '{print $2}')
		editor=$(grep "$alias" < "$cache" | head -n 1 | awk '{print $3}')

		cd "$path"
		$editor .
	else
		echo "error: Alias not found."
	fi
fi
